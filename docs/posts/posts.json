[
  {
    "path": "posts/2022-02-22-a6wrangling/",
    "title": "Data Visualization: Mono Lake",
    "description": {},
    "author": [],
    "date": "2022-03-13",
    "categories": [],
    "contents": "\n\n\nhide\n\n#load data\nlake_levels <- read_csv(here(\"data\", \"mono_lake_annual_levels.csv\"), skip = 5) %>% \n  clean_names()\n\n\n\nMono Lake is a terminal lake in California that is supported by freshwater inflows from nearby rivers. Water diversions from the rivers reduced the inflows to the lake. As a result, the salinity in the lake has been increasing as lake levels drop. Courts have mandated that a minimum elevation to ensure proper ecosystem function.\n\n\nhide\n\nggplot(lake_levels, aes(x= year, y= lake_level_feet_above_sea_level))+\n  geom_line()+\n  scale_x_continuous(limits = c(1850,2017),\n                     breaks = seq(1850, 2017, 20) )+\n  coord_cartesian(xlim =c(1850, 2017))+\n    labs(y = \"Lake Surface Elevation (ft)\",\n       title = \"Mono Lake, CA Surface Level and Critical Ecological Thresholds \\n (1850-2017) \")+\n  geom_hline(yintercept= 6377.0, #land bridge level\n             linetype = \"dashed\")+\n  annotate(geom = \"text\",\n           size = 3,\n           x = 1850,\n           y = 6378.2,\n           label = \"Land Bridges Emerge (6,377 ft)\",\n           hjust = \"left\")+\n  geom_hline(yintercept= 6360.0,\n             linetype = \"dashed\")+ #Salinity impacts on brine shrimp\n  annotate(geom = \"text\",\n           size = 3,\n           x = 1850,\n           y = 6361.2,\n           label = \"Critical Salinity Level (6,260 ft)\",\n           hjust = \"left\")+\n    geom_hline(yintercept= 6392.0,  #critical lake level set by decision 1631\n             color = \"blue\")+\n  annotate(geom = \"text\",\n           size = 3,\n           x = 1850,\n           y = 6393.2,\n           label = \"Target Lake Level (6,392 ft)\",\n           hjust = \"left\")+\n   annotate(         #diversion begin \n    geom = \"curve\",\n    x = 1954, \n    y = 6424.00, \n    xend = 1943, \n    yend = 6418.40, \n    curvature = .3, \n    arrow = arrow(length = unit(1, \"mm\")))+\n  annotate(geom = \"text\",\n           size = 3,\n           x = 1954, \n           y = 6424.00, \n           label = \"Diversions \\nBegin (1941)\", \n           hjust= \"left\") +\n   annotate(            #1994 Decision 1631\n    geom = \"curve\",\n    x = 1987, \n    y = 6370.00, \n    xend = 1994, \n    yend = 6374.00, \n    curvature = .3, \n    arrow = arrow(length = unit(1, \"mm\"))\n  ) +\n  annotate(geom = \"text\",\n           size = 3,\n           x = 1987, \n           y = 6366.00, \n           label = \"Target Lake\\nLevel Declared\\n(1994)\", \n           hjust= \"right\")+\n  theme_minimal()+\n  theme(plot.title = element_text(hjust=0.5),\n        axis.title.y = element_text(margin = margin(t = 0, r = 3, b = 0, l =0)),\n        axis.title.x = element_blank(),\n        axis.line= element_line(size = 1))\n\n\n\n\nFigure 1: The figure depicts the water levels in Mono Lake (CA) from 1850- 2017 and the lake levels of three critical thresholds: the state-determined target to meet ecological function, the emergence of land bridges that connect lake islands to the shore, and salinity concentrations that limit brine shrimp. Also noted are the dates of LA water diversions (1941) and the declaration of a minimum lake level by the State Water Resources Control Board (1994).\n\n\n\n",
    "preview": "posts/2022-02-22-a6wrangling/a6wrangling_files/figure-html5/unnamed-chunk-2-1.png",
    "last_modified": "2022-03-13T17:44:11-07:00",
    "input_file": "a6wrangling.knit.md"
  },
  {
    "path": "posts/2022-01-24-welcone/",
    "title": "Hello!",
    "description": {},
    "author": [],
    "date": "2022-03-13",
    "categories": [],
    "contents": "\nWelcome to my new personal website! I look forward to sharing my projects and research interests with you here.\n\n\n\n",
    "preview": {},
    "last_modified": "2022-03-13T16:31:49-07:00",
    "input_file": "welcone.knit.md"
  },
  {
    "path": "posts/2022-02-22-beeswarm/",
    "title": "Example Report: Statistical Exploration and Linear Modeling",
    "description": {},
    "author": [],
    "date": "2022-03-13",
    "categories": [],
    "contents": "\n\n\nhide\n\nknitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)\nlibrary(tidyverse)\nlibrary(dplyr)\nlibrary(janitor)\nlibrary(here)\nlibrary(lubridate)\nlibrary(broom)\nlibrary(ggpubr)\nlibrary(ggbeeswarm)\nlibrary(kableExtra)\nlibrary(effsize)\n\nbonanza_hares <- read.csv(here(\"bonanza_hares.csv\"))\n\n\n\n1. Introduction\nIn this report, I conduct a preliminary analysis of juvenile snowshoe hare (Lepus americanus) observations collected in the Tanana Valley of Bonanza Creek Experimental Forest between 1999 and 2012 (Kielland et al. 2017). This analysis compares body weight between three collection sites (Black Fir, Mature and Riparian) and sex, and explores the relationship between weight (g) and hind foot length (mm).\n2. Data and Analysis\nData used in the report was collected and distributed by Dr. Knut Kielland and members of the Long Term Ecological Research network (LTER). Data was collected from Bonanza Creek Experimental Forest in central Alaska between 1999 and 2012. THe analysis used a subset of 378 observations identified as juvenile hares from the full dataset of 3197 observations. The analysis begin with a series of data visualization and exploration. The difference in Weights between the two sexes was then explored using a two sample t-test with a significance level of (\\(\\alpha\\))= 0.05. Cohen’s d was used to explore effect size. A simple linear regression model is used to explore hare weight (g) to hind foot length (mm).\nAnalysis was conducted in R (4.0.2) and R Studio (1.3.1056)\n3. Preliminary Results\nA. Annual Trap Counts\n\n\nhide\n\n# Create the juvenile hares dataset and parse the dates to call the years\njuvi_hares<- bonanza_hares %>% \n  filter(age == \"j\") %>% \n  mutate(date = mdy(date)) %>% \n  mutate(year = year(date))\n\n\nhare_count <- juvi_hares %>% \n  group_by(year)\n\nannual_total <- juvi_hares %>% \n  group_by(year) %>% \n  count() \n\nggplot(hare_count, aes(x = year))+\n  geom_bar() +\n  labs(x = \"Sample Year\")+\n  scale_x_continuous(breaks = seq(1999, 2012, 1), expand = c(.01,0))+\n  scale_y_continuous(breaks = seq(0, 150, 20), expand = c(0,0))+\n  theme_light()+\n  theme(panel.grid.major.x = element_blank(),\n        panel.grid.minor = element_blank(),\n        plot.caption = element_text(hjust = 0.5))\n\n\n\n\nFigure 1. Juvenile snowshoe hare observations at Bonanza Creek Experimental forest trap sites. Although trapping occurred in 2002 and 2009, there were no observations of juvenile hares in those years. Data: Kielland et al. 2017.\nThe highest number of observations of juvenile snowshoe hares occurred in 1999 (n = 126) and the lowest occurred in 2002 and 2010 (n=0) when no observations of juvenile hares were made though there are observations of hares without age recorded (NA). The mean count was 29 observations. The number of juvenile observations is generally decreasing from 1999 to 2012. To standardize the observations across the years, future analysis should divide the number of total observations by the annual trap days (total sum of days each trap was set) to standardize the observations for the amount of effort each year.\nB. Juvenile Hare Weight Comparison (Data Visualization)\n\n\nhide\n\n#Code drawn heavily from Allison's example \n\nggplot(juvi_hares, aes(x = sex, y = weight))+  # call dataset and variables\n  geom_beeswarm(aes(color= sex), size = 1.5)+  # beeswarm to show the actual shape of the observtions\n  scale_color_manual(values = c(\"blue\",\"red\"), #call colorrs for sex\n                     labels = c(\"Female\", \"Male\", \"Not Recorded\")) + #rename in legend\n  facet_wrap(~grid, )+  #facet wrap by site\n  geom_boxplot(fill = NA, width = 0.2, outlier.color = NA) + #box plot to show \n  stat_summary(fun=mean, \n               geom=\"point\", \n               shape=20,\n               size=4, \n               color=\"black\", \n               fill=\"black\")+\n  labs(y = \"weight (g)\") +\n  theme(plot.caption = element_text(hjust = 0.5))\n\n\n\n\nFigure 2. Weight (g) of male, female, and unrecorded sex (NA) juvenile snowshoe hares. Observations at three collection sites in Bonanza Creek Experiemental Forest between 1999 and 2012. Red (female) and blue (male) points represent individual observations. Black dots indicate the mean, central black lines indicate the median and the edges of the box represent the 25th and 75th percentiles. Data: Kielland et al. 2017. Code: Horst 2020.”\nThe mean body mass (g) of male juvenile hares appear to be larger than female hares across all sites. Hares from the Black Spruce site appear to have a higher body mass (female mean=1022.1g; male mean= 1073.1g) than hares in the Mature stand (female mean =808.2; male mean = 950.1) and Riparian site (female mean =824.1; male mean =925.3). Males from the Mature site have a noticeable group of observations that fall below the 75th percentile that may warrant further analysis.\nC. Juvenile Hare Weight and Sex Comparison (Statistical)\nTable 1. Summary statistics (mean, median, standard deviation and sample size) for male and female juvenile hares observations collected via trap sampling in Bonanza Creek Experimental Forest. Data: Kielland et al. 2017.\n\n\nhide\n\nsummary_stats <- juvi_hares %>% \n  group_by(sex) %>% \n  summarize(\n    mean_weight = mean(weight, na.rm = TRUE),\n    median_weight = median(weight, na.rm = TRUE),\n    sd_weight = sd(weight, na.rm = TRUE),\n    n= n())\n\nsummary_stats %>% \n  kable(col.names = c(\"Sex\", \"Mean hare weight (g)\", \"Median hare weight (g)\", \"Standard Deviation\", \"Sample size\"),\n        digits = 2) %>% \n  kable_styling(bootstrap_options = \"striped\", full_width = FALSE)\n\n\n\nSex\n\n\nMean hare weight (g)\n\n\nMedian hare weight (g)\n\n\nStandard Deviation\n\n\nSample size\n\n\nf\n\n\n855.39\n\n\n825\n\n\n292.25\n\n\n200\n\n\nm\n\n\n945.86\n\n\n990\n\n\n333.22\n\n\n163\n\n\nNA\n\n\n614.55\n\n\n650\n\n\n357.59\n\n\n15\n\n\nWeight (g) of male and female juvenile hares appears normally distributed. Weights of male and female hares were compared with a two-sample t-test. With an actual difference in means of 90.5 grams and p-value of 0.007, the weight of male snowshoe hares (945.86 \\(\\pm\\) 333.22 g, n = 163; mean \\(\\pm\\) 1 standard deviation) and female snowshoe hares(855.39 \\(\\pm\\) 292.25 g, n = 200; mean \\(\\pm\\) 1 standard deviation) is significant (Table 1). The sample effect size was small (Cohen’s d = -0.29).\nD. Weight and Hind Foot Length Relationship\n\n\nhide\n\nggplot(juvi_hares) +\n  geom_point(aes(x = weight, \n                 y = hindft))+\n  labs( x= \"Weight (g)\",\n        y = \"Hind Foot Length (mm)\")\n\n\n\n\nFigure 3. Weight (g) and hind foot length (mm) of juvenile snowshoe hares (n=378) in across all three sampling sites in Bonanza Creek Experimental Forest between 1999 and 2012. Data: Kielland et al. 2017.\nDistribution of weight(g) compared to hind foot length (mm) of juvenile hares (Figure 3) may be linear to follow a linear trend. Variance is high and there is not an apparent linear trend.\nE. Weight and Foot Length Linear Regression\n\n\nhide\n\nggplot(data = juvi_hares, aes(\n  x = weight,\n  y = hindft\n)) +\n  geom_point()+\n  labs( x = \"Weight (g)\",\n        y = \"Hind Foot Length (mm)\")+\n  scale_y_continuous(breaks = seq(0, 200, 50))+\n  geom_smooth(method =\"lm\",\n              color = \"blue\",\n              size = 0.7, \n              fill = \"grey20\",\n              alpha= 0.5)+\n  theme_minimal()+\n  stat_regline_equation() #can specify location of equation on chart\n\n\n\n\nFigure 4. Linear regression model fit for juvenile snowshoe hare weight (g) and hind foot length (mm). Data: Kielland et al. 2017.\nA linear regression model does not seem like an appropriate representation of the relationship between foot size and weight. The R2 value of 0.299 suggests that only 30% of the variance in hind foot length can be predicted by the weight of the juvenile hare. The slope suggets that hares gain an additional 1 gram of weight as they gain 9.59 mm of foot length. However, the intercept (-279.34) is not physically possible. The Pearson’s r value of 0.55 suggests a moderate positive correlation between footlength and weight. However, the residuals do not follow a normal distribution and are heteroscedastic suggeting a linear model may not be the appropriate model for this relationship. Further study into the relationship should include site or sex variables.\n4. Summary\nMale and female juvenile snowshoe hares have significant differences in weight (p-value = 105.2)\nA linear model may be inappropriate to describe the relationship between the two variables based on the heteroscedasticity and non-normal distribution of the residuals.\nHind foot length cannot be fully predicted by body mass\nNext Steps: \nExpand hind foot v. weight analysis to include site (grid) and sex variables\n5. Citations\nKielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14\nHorst, A. 2020. Example mini-report (penguins). Gauchospace.\n\n\n\n",
    "preview": "posts/2022-02-22-beeswarm/beeswarm_files/figure-html5/annual trap counts-1.png",
    "last_modified": "2022-03-13T16:58:32-07:00",
    "input_file": "beeswarm.knit.md"
  },
  {
    "path": "posts/2022-03-13-textanalysis/",
    "title": "Star Wars IV: A New Hope Text Analysis",
    "description": {},
    "author": [],
    "date": "2022-03-13",
    "categories": [],
    "contents": "\n\n\nhide\n\nknitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)\n\nlibrary(tidyverse)\nlibrary(here)\nlibrary(tidytext) #functions for sentiment analysis\nlibrary(textdata)\nlibrary(pdftools)\nlibrary(wordcloud2) #generate wordcloud\nlibrary(ggdark) #mark dark backgrounds in ggplot\nlibrary(plotly)\n\n\n\nOverview:\nThis post explores work frequency and sentiment in the script of Star Wars Episode IV: A New Hope and visualized using a plot and a wordcloud. A sentiment analysis using the “bing” lexicon is then used to determine the mean sentiment per page. Sentiment is plotted with key plots points.\n\n\nhide\n\nsw_script <- pdf_text(here(\"data\", \"starwars_fourth3_76.pdf\"))\n\n#each row is a page (148 pages overall) so break into pages and lines of text\nsw_script <- as.data.frame(sw_script) %>% \n  mutate(page = 1:n()) %>% \n  mutate(full_text = str_split(sw_script, pattern = \"\\\\n\")) %>%  #\n  unnest(full_text) %>% \n  mutate(full_text = str_squish(full_text)) \n  \n#make words into the token\n sw_words <- sw_script %>% \n #switched into one row per word and converted it into lower case\n  unnest_tokens(word, full_text, token = \"words\") %>%  \n  select(-sw_script)\n\n x <- stop_words\n \n#remove stopwords removed\nsw_clean<- sw_words %>% \n  anti_join(stop_words, by = \"word\") %>% \n  filter(word != \"int\") %>% #stage word in script\n  filter(word != \"ext\") \n\n#word frequency for whole document\nsw_wordcount <- sw_clean %>% #stage word in script\n  count(word)\n\n#wordcount by page\nsw_wordcount_page<- sw_clean %>% \n  group_by(page) %>% \n  count(word) %>% \n  ungroup()\n\n\n\nWord Frequency Analysis\n\n\nhide\n\n#for figure\ntop_20_words <- sw_wordcount %>% \n  arrange(-n) %>% \n  slice(1:20)\n\n#for wordcloud\ntop_100_words <- sw_wordcount %>% \n  arrange(-n) %>% \n  slice(1:100)\n\n#figure\nggplot(top_20_words, aes(x= n,  y= reorder(word, n)))+\n  geom_bar(stat = \"identity\", fill = \"#999999\")+\n  dark_theme_classic()+\n  theme(plot.title = element_text(hjust = 0.5),\n        plot.subtitle = element_text(hjust = 0.5))+\n  labs(title = \"Star Wars Episode IV: New Hope\",\n       subtitle = \"Script Word Frequency Analysis\",\n       y = \"Top 20 Words\",\n       x = \"Word Frequency\")\n\n\n\n\nFigure 1: Top 20 words in used in the ‘A New Hope’ script arranged in descending order. Data: Star Wars IV: A New Hope (Revised Fourth Draft).\n\n\nhide\n\n#changes the background colour of the plot with black \nwordcloud2(data=top_100_words,\n           size = 1.2,\n           color = 'random-light',\n           backgroundColor = 'Black')\n\n\n\n{\"x\":{\"word\":[\"luke\",\"han\",\"star\",\"death\",\"threepio\",\"cockpit\",\"ben\",\"red\",\"artoo\",\"leia\",\"fighter\",\"vader\",\"wing\",\"luke's\",\"ship\",\"leader\",\"space\",\"surface\",\"biggs\",\"imperial\",\"tie\",\"gold\",\"rebel\",\"falcon\",\"fighters\",\"millennium\",\"laser\",\"control\",\"voice\",\"stormtroopers\",\"chewbacca\",\"head\",\"tarkin\",\"vader's\",\"sir\",\"computer\",\"main\",\"owen\",\"trooper\",\"darth\",\"leader's\",\"moves\",\"officer\",\"tatooine\",\"princess\",\"huge\",\"pirateship\",\"trench\",\"station\",\"begins\",\"bay\",\"hallway\",\"move\",\"robot\",\"door\",\"suddenly\",\"time\",\"troops\",\"fire\",\"power\",\"hold\",\"planet\",\"wedge\",\"past\",\"robots\",\"massassi\",\"chewie\",\"laserfire\",\"solo\",\"speeder\",\"kenobi\",\"makes\",\"sand\",\"stands\",\"targeting\",\"alderaan\",\"blast\",\"speaker\",\"war\",\"battle\",\"force\",\"headset\",\"intercom\",\"outpost\",\"screen\",\"beeps\",\"controls\",\"eyes\",\"fires\",\"hit\",\"starts\",\"beeping\",\"races\",\"rock\",\"sounds\",\"adjusts\",\"comlink\",\"docking\",\"front\",\"garbage\"],\"freq\":[616,266,234,232,213,196,165,156,142,139,117,114,113,111,107,94,90,90,86,85,82,72,71,65,63,63,56,52,50,49,48,47,47,47,46,45,45,45,45,44,44,44,44,44,43,41,41,41,38,37,35,34,34,34,33,33,33,33,32,32,31,31,31,30,30,29,28,28,28,28,27,27,26,26,26,25,25,25,25,24,24,24,24,24,24,23,23,23,23,23,23,22,22,22,22,21,21,21,21,21],\"fontFamily\":\"Segoe UI\",\"fontWeight\":\"bold\",\"color\":\"random-light\",\"minSize\":0,\"weightFactor\":0.350649350649351,\"backgroundColor\":\"Black\",\"gridSize\":0,\"minRotation\":-0.785398163397448,\"maxRotation\":0.785398163397448,\"shuffle\":true,\"rotateRatio\":0.4,\"shape\":\"circle\",\"ellipticity\":0.65,\"figBase64\":null,\"hover\":null},\"evals\":[],\"jsHooks\":{\"render\":[{\"code\":\"function(el,x){\\n                        console.log(123);\\n                        if(!iii){\\n                          window.location.reload();\\n                          iii = False;\\n\\n                        }\\n  }\",\"data\":null}]}}\nFigure 2: Wordcloud displaying the top 100 most frequently used words in the A New Hope script. Size corresponds to frequency in the text. Stop words have been removed. Data: Star Wars IV: A New Hope (Revised Fourth Draft).\nSentiment Analysis\n\n\nhide\n\nget_sentiments(lexicon = \"bing\")\n\n\n\n\n\nhide\n\n#sentiment analysis using bing lexicon\n#sentiment analysis \nsw_afinn <- sw_clean %>% \n  inner_join(get_sentiments(\"afinn\"), by = \"word\")\n\n# Find the mean afinn score by page: \nafinn_means <- sw_afinn %>% \n  group_by(page) %>% \n  summarize(mean_afinn = mean(value))\n\nggplot(data = afinn_means, \n       aes(x = page,\n           y = mean_afinn)) +\n  geom_col() +\n  ylim(-2, 2)+\n  coord_flip()+\n  dark_theme_classic()+\n  theme(plot.title = element_text(hjust = 0.5),\n        plot.subtitle = element_text(hjust = 0.5))+\n  labs(title = \"Star Wars Episode IV: New Hope\",\n       subtitle = \"Script Sentiment Analysis\",\n       y = \"Mean Sentiment Score\",\n       x = \"Page No.\")+ \n  #darth vader entrance\n  geom_curve(x = 15, y = -2,\n             xend = 2, yend = -1.78,\n            color = 2,\n            size = .5,\n            arrow = arrow(type = \"closed\", length=unit(2, \"mm\")),\n            lwd=10)+\n    annotate(\"text\", \n             x=20, \n             y=-2, \n           label='Darth Vader \\n Entrance',\n           size = 2) +\n  #hatch Leia rescue plan\n    geom_curve(x = 60, y = 1.5,\n             xend = 73, yend = 1.37,\n            color = 2,\n            size = .5,\n            arrow = arrow(type = \"closed\", length=unit(2, \"mm\")),\n            lwd=10)+\n    annotate(\"text\", \n             x=54, \n             y=1.5, \n           label='Hatch Plan to \\n Rescue Leia',\n           size = 2)+\n  #in the garbage compactor\n      geom_curve(x = 100, y = -1.78,\n             xend = 87, yend = -2.0,\n            color = 2,\n            size = .5,\n            arrow = arrow(type = \"closed\", length=unit(2, \"mm\")),\n            lwd=10)+\n      annotate(\"text\", \n             x= 98, \n             y=-1.57, \n           label='In the Garbage \\n Compactor',\n           size = 2)\n\n\n\n\nFigure 3: Sentiment analysis for Star Wars Episode IV: A New Hope by page in script using Bing lexicon to code words from most negative (-2) to most positive (2). Figure displays mean sentiment score by page. Data: Star Wars IV: A New Hope (Revised Fourth Draft).\nData: Lucas, George.Star Wars Episode IV: A New Hope (Revised Fourth Draft). https://maddogmovies.com/almost/scripts/starwars_fourth3_76.pdf\n\n\n\n",
    "preview": "posts/2022-03-13-textanalysis/textanalysis_files/figure-html5/visualize top 20 words-1.png",
    "last_modified": "2022-03-13T17:35:27-07:00",
    "input_file": "textanalysis.knit.md"
  },
  {
    "path": "posts/2022-03-13-time-series/",
    "title": "Time Series",
    "description": "Using 'feasts' to explore time series data",
    "author": [],
    "date": "2022-03-13",
    "categories": [],
    "contents": "\n\n\nhide\n\nknitr::opts_chunk$set(echo = TRUE, warning= FALSE, message = FALSE)\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(here)\nlibrary(rmdformats)\nlibrary(patchwork)\n\n#for timeseries\nlibrary(lubridate) #dealing with dates\nlibrary(tsibble)\nlibrary(feasts) #dealing with time series\nlibrary(slider)\nlibrary(RColorBrewer)\n\n\n\n\n\nhide\n\n#clean names and keep only the date column and the counts containing steelhead, coho and jack coho counts\nfish <- read_csv(here(\"data\",\"willamette_fish_passage.csv\")) %>% \n  clean_names() %>% \n  select(date, steelhead, coho, jack_coho) %>% \n  \n#change counts less than 0 to 0 \n  mutate(steelhead = case_when(steelhead< 0 ~ 0, \n                               TRUE ~ steelhead)) %>% \n   mutate(coho = case_when(coho< 0 ~ 0, \n                               TRUE ~ coho)) %>% \n  mutate(jack_coho = case_when(jack_coho< 0 ~ 0, \n                               TRUE ~ jack_coho))\n\n\n\nOverview\nThis report explores fish passage counts of Coho salmon (Oncorhynchus kisutch) and Steelhead salmon (Oncorhynchus mykiss) at Willemette Falls for a ten year period beginning Jan 1, 2000. The Willamette Falls in Oregon are the site of a a large hydropower facility with a fish passage structure to facilitate migration along the river. The report looks at annual and seasonal trends in Steelhead, Coho, and jack Coho passage through Willamette Falls. Jacks are male salmon that return to spawn a year earlier than other adult Coho salmon.\n Data:  Columbia River Basin Data Access in Real Time. Adult Passage (database). Accessed: March 8, 2022. http://www.cbr.washington.edu/dart/query/adult_graph_text\nData Analysis\nOriginal Time Series\nCoho salmon counts are increasing with time though jack salmon counts appear to be remaining stable\nCoho salmon appear to pass through the fish passage approx. once a year during a discreet period\nSteelhead salmon have much less discrete time periods when they move through the fish passage though they appear to have a seasonal trend\n\n\nhide\n\n#change date column from 'character' to 'mdy' format date\n\nfish_ts <- fish %>% \n  mutate(date = lubridate::mdy(date)) %>% \n   as_tsibble(key = NULL, index = date)\n\n#change NA to 0 in the dataset\nfish_ts[is.na(fish_ts)]= 0\n\n\n\n\n\nhide\n\n#plot steelhead\nsh_ts <- ggplot(data = fish_ts, aes(x = date)) +\n  geom_line(aes(y = steelhead), color = \"#999999\")+\n  labs(x = \"\",\n       y = \"Daily Count\",\n       title = \"Steelhead salmon\", \n       color = \"\")+\n  theme_classic()+\n  theme(plot.title = element_text(hjust = 0.5))\n\n#plot coho (adult and jack)\nco_ts <- ggplot(data = fish_ts, aes(x = date)) +\n  geom_line(aes(y = coho), color = \"#00AFBB\") +\n  geom_line(aes(y = jack_coho), color = \"#C4961A\") +\n  labs(x = \"Date\",\n       y = \"Daily Count\",\n       title = \"Coho salmon\",\n       color = \"Type\")+\n ylab(\"\")+\n  theme_classic()+\n  theme(plot.title = element_text(hjust = 0.5))\n\n#plot together with patchwork\nsh_ts/co_ts\n\n\n\n\nFig 1: Daily count of Steelhead and Coho salmon at Willamette falls fish passage in Oregon between January 1, 2000 and Dec 31, 2010. Coho salmon show counts of jack salmon (yellow) which return one year earlier than other adult salmon (blue) to spawn. Y-axis are different scales (Data: Columbia River DART)\nSeasonpolots\nSteelhead salmon move through the fish passage in spring and early summer and have a much longer period of travel along the river\nCoho and jack Coho salmon migrate through the fish passage in late summer. Fish passage counts peak in September.\nCoho salmon appear to be more abundant in later years of the observation period\n\n\nhide\n\n#create seasonal datasets\ncoho_month <- fish_ts %>% \n  index_by(yr_mo = ~yearmonth(.)) %>% #equivalent of doing group_by for normal dataframe\n  #dot shows to apply to this dataset\n  summarize(mean = mean(coho, na.rm = TRUE)) \n\ncohoj_month <- fish_ts %>% \n  index_by(yr_mo = ~yearmonth(.)) %>% #equivalent of doing group_by for normal dataframe\n  #dot shows to apply to this dataset\n  summarize(mean = mean(jack_coho, na.rm = TRUE)) \n\nsh_month <- fish_ts %>% \n  index_by(yr_mo = ~yearmonth(.)) %>% #equivalent of doing group_by for normal dataframe\n  #dot shows to apply to this dataset\n  summarize(mean = mean(steelhead, na.rm = TRUE)) \n\n#plot seasonal datasets\n#coho\nmonth_coho <- coho_month %>% \n  gg_season(y = mean, pal = brewer.pal(10, name =\"Spectral\")) + \n  labs(title = \"Coho \",\n       x = \"\",\n       y = \"\") +\n  theme_classic()+\n  theme(plot.title = element_text(hjust = 1),\n        legend.position = \"none\")+ \n  scale_y_continuous(breaks =seq(0, 500, by = 250))\n\n#jack coho\nmonth_cohoj <- cohoj_month %>% \n   gg_season(y = mean, pal = brewer.pal(10, name =\"Spectral\"))+ \n labs(title = \"Jack Coho\",\n       x = \"Month\",\n       y = \"\")+\n  theme_classic()+\n  theme(plot.title = element_text(hjust = 1),\n        legend.position = \"bottom\")+\n  guides(color = guide_legend(nrow = 1, byrow = TRUE))+\n  scale_y_continuous(breaks =seq(0, 60, by = 30))\n\n#steelhead\nmonth_sh <- sh_month %>% \n    gg_season(y = mean, pal = brewer.pal(10, name =\"Spectral\"))+\n   labs(title = \"Steelhead\",\n       x = \"\",\n       y = \"\")+\n  theme_classic()+\n  theme(plot.title = element_text(hjust = 1),\n        legend.position = \"none\")+\n  scale_y_continuous(breaks =seq(0, 500, by = 250), limits = c(0, 500))\n\nylab <- \"Average Monthly Fish Count\"\n\n#aggregate into one plot\nmonth_sh/month_coho/month_cohoj + \n  plot_layout(heights = c(5, 5, 5)) + \n  plot_annotation(\n    title = 'Monthy Fish Passage Count, 2000-2010',\n    theme = theme(plot.title = element_text(size = 14, hjust = 0.5)))\ngrid::grid.draw(grid::textGrob(ylab, x = 0.02, rot = 90))\n\n\n\n\nFig 2: Mean monthly count of Steelhead, Coho and jack Coho salmon at the Willamette Falls fish passage between 1/1/2000 and 12/31/2010. Note that the y-axis scale of jack Coho is different than the other two (Data: Columbia River DART)\nAnnual Count by species\nCoho salmon counts significantly increased in 2009 and 2010 though futher analysis will be needed to understand if this is a long-term trend\nAnnual jack Coho counts appear to have a cyclical pattern\nSteelhead salmon populations remained steady from 2000-2010 and experienced no significant changes in population over the 10 year period\n\n\nhide\n\n#wrnagle data \n#coho\ncoho_annual <- fish_ts %>% \n  index_by(yearly = ~year(.)) %>% \n  summarize(sum = sum(coho, na.rm = TRUE))\n\n#jack coho\ncohoj_annual <- fish_ts %>% \n  index_by(yearly = ~year(.)) %>% \n  summarize(sum = sum(jack_coho, na.rm = TRUE))\n\n#steelhead\nsh_annual <- fish_ts %>% \n  index_by(yearly = ~year(.)) %>% \n  summarize(sum = sum(steelhead, na.rm = TRUE))\n\n\n\n\n\nhide\n\n#steelhead\np1<- ggplot(sh_annual, aes(x = yearly, y = sum)) +\n  geom_line(color = \"#999999\", fill = \"#999999\")+\n  \n  scale_x_continuous(breaks = seq(2000, 2010, 1))+\n  scale_y_continuous(breaks = seq(0, 60000, 20000), limits = c(0, 60000))+\n  theme_classic()+   \n  labs(title = \"Steelhead\",\n       x = \"\",\n       y = \"\")+\n  theme(plot.title = element_text(hjust = 1),\n        legend.position = \"none\")\n\n#Coho\np2<- ggplot(coho_annual, aes(x = yearly, y = sum)) +\n  geom_line(color = \"#00AFBB\", fill = \"#00AFBB\")+\n\n  scale_x_continuous(breaks = seq(2000, 2010, 1))+\n  scale_y_continuous(breaks = seq(0, 30000, 10000), limits = c(0, 30000))+\n  theme_classic()+\n    labs(title = \"Coho\",\n       x = \"\",\n       y = \"\")+\n  theme(plot.title = element_text(hjust = 1),\n        legend.position = \"none\")\n\n#Jack Coho\np3<- ggplot(cohoj_annual, aes(x = yearly, y = sum)) +\n    geom_line(color = \"#C4961A\", fill = \"#C4961A\")+\n  scale_x_continuous(breaks = seq(2000, 2010, 1))+\n  scale_y_continuous(breaks = seq(0, 3000, 1000))+\n  theme_classic() +\n    labs(title = \"Jack Coho\",\n       x = \"Year\",\n       y = \"\")+\n  theme(plot.title = element_text(hjust = 1),\n        legend.position = \"none\")\n\nylabs <- \"Total Fish Count\"\n\np1/p2/p3 + plot_layout(heights = c(5, 5, 5)) + \n  plot_annotation(\n    title = 'Annual Fish Count, 2000-2010',\n    theme = theme(plot.title = element_text(size = 14, hjust = 0.5)))\ngrid::grid.draw(grid::textGrob(ylabs, x = 0.02, rot = 90))\n\n\n\n\nFig 3: Total annual fish count through Willamette Falls fish ladder from 2000-2010. Y-axis scales are not the same between figures. (Data: Columbia River DART)\n\n\n\n",
    "preview": "posts/2022-03-13-time-series/time-series_files/figure-html5/plot timeseries-1.png",
    "last_modified": "2022-03-13T18:01:04-07:00",
    "input_file": "time-series.knit.md"
  }
]
